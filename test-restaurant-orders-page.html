<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Restaurant Orders</title>
</head>
<body>
    <h1>Testing Restaurant Orders API</h1>
    <div id="result"></div>

    <script>
        async function testOrders() {
            const resultDiv = document.getElementById('result');
            
            // First, login
            resultDiv.innerHTML = '<p>Step 1: Logging in as restaurant...</p>';
            
            try {
                const loginResponse = await fetch('http://localhost:5000/api/restaurant/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'spicepalace@restaurant.com',
                        password: 'password123'
                    })
                });

                const loginData = await loginResponse.json();
                
                if (!loginData.token) {
                    resultDiv.innerHTML += '<p style="color: red;">❌ Login failed: ' + (loginData.message || 'No token') + '</p>';
                    return;
                }

                resultDiv.innerHTML += '<p style="color: green;">✅ Login successful</p>';
                resultDiv.innerHTML += '<p>Token: ' + loginData.token.substring(0, 30) + '...</p>';

                // Now fetch orders
                resultDiv.innerHTML += '<p>Step 2: Fetching orders...</p>';

                const ordersResponse = await fetch('http://localhost:5000/api/restaurant/orders?limit=100', {
                    headers: {
                        'Authorization': 'Bearer ' + loginData.token,
                        'Content-Type': 'application/json'
                    }
                });

                resultDiv.innerHTML += '<p>Response status: ' + ordersResponse.status + '</p>';

                const ordersData = await ordersResponse.json();
                
                resultDiv.innerHTML += '<p>Response data:</p>';
                resultDiv.innerHTML += '<pre>' + JSON.stringify(ordersData, null, 2) + '</pre>';

                if (ordersData.success && ordersData.orders) {
                    resultDiv.innerHTML += '<p style="color: green;">✅ Orders loaded: ' + ordersData.orders.length + '</p>';
                } else {
                    resultDiv.innerHTML += '<p style="color: red;">❌ Failed to load orders</p>';
                }

            } catch (error) {
                resultDiv.innerHTML += '<p style="color: red;">❌ Error: ' + error.message + '</p>';
            }
        }

        // Run test on page load
        testOrders();
    </script>
</body>
</html>
