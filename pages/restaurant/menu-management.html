<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Management - TasteNow</title>

    <link rel="stylesheet" href="../../assets/css/base.css">
    <link rel="stylesheet" href="../../assets/css/components.css">
    <link rel="stylesheet" href="../../assets/css/layout.css">
    <link rel="stylesheet" href="../../assets/css/pages.css">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar container">
            <a href="../../index.html" class="navbar-brand">
                <i class="fas fa-utensils"></i>
                TasteNow
            </a>

            <button class="navbar-toggle" id="navbarToggle">
                <i class="fas fa-bars"></i>
            </button>

            <div class="navbar-menu" id="navbarMenu">
                <a href="dashboard.html" class="navbar-link">Dashboard</a>
                <a href="orders.html" class="navbar-link">Orders</a>
                <a href="menu-management.html" class="navbar-link active">Menu</a>
                <a href="reviews.html" class="navbar-link">Reviews</a>
            </div>

            <div class="navbar-actions">
                <a href="notifications.html" class="navbar-icon">
                    <i class="fas fa-bell"></i>
                    <span class="navbar-badge" id="notificationBadge">0</span>
                </a>
                <button class="btn btn-outline btn-sm" onclick="logout()">Logout</button>
            </div>
        </nav>
    </header>

    <!-- Main Content with Sidebar -->
    <div class="container">
        <div class="layout-sidebar mt-xl mb-xl">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-menu">
                    <a href="dashboard.html" class="sidebar-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="orders.html" class="sidebar-link">
                        <i class="fas fa-receipt"></i>
                        <span>Orders</span>
                    </a>
                    <a href="menu-management.html" class="sidebar-link active">
                        <i class="fas fa-utensils"></i>
                        <span>Menu Management</span>
                    </a>
                    <a href="reviews.html" class="sidebar-link">
                        <i class="fas fa-star"></i>
                        <span>Reviews</span>
                    </a>
                   
                </div>

                <!-- Quick Actions -->
                <div class="mt-xl" style="padding: var(--spacing-md); background-color: var(--light-gray); border-radius: var(--radius-md);">
                    <h4 class="mb-md">Quick Actions</h4>
                   
                    <button class="btn btn-secondary btn-block btn-sm" onclick="openModal('addCategoryModal')">
                        <i class="fas fa-folder-plus"></i> Add Category
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Page Header -->
                <div class="dashboard-header">
                    <div class="d-flex justify-between align-center">
                        <div>
                            <h1>Menu Management</h1>
                            <p class="text-muted">Manage your restaurant menu items and categories</p>
                        </div>
                        <button class="btn btn-primary" onclick="openAddItemModal()">
                            <i class="fas fa-plus"></i> Add New Item
                        </button>
                    </div>
                </div>

                <!-- Menu Stats -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                    <div class="stat-card" style="border-left-color: var(--primary-color);">
                        <div class="stat-value" id="totalItems">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat-card" style="border-left-color: var(--success-color);">
                        <div class="stat-value" id="availableItems">0</div>
                        <div class="stat-label">Available</div>
                    </div>
                    <div class="stat-card" style="border-left-color: var(--warning-color);">
                        <div class="stat-value" id="unavailableItems">0</div>
                        <div class="stat-label">Out of Stock</div>
                    </div>
                    <div class="stat-card" style="border-left-color: var(--info-color);">
                        <div class="stat-value" id="totalCategories">0</div>
                        <div class="stat-label">Categories</div>
                    </div>
                </div>

                <!-- Category Tabs -->
                <div class="nav-pills" id="categoryTabs">
                    <div class="nav-pill active" data-category="all" onclick="filterByCategory('all')">All Items</div>
                </div>

                <!-- Search and Filter -->
                <div class="card">
                    <div class="card-body" style="padding: var(--spacing-md);">
                        <div class="d-flex gap-md align-center">
                            <input type="text" class="form-control" placeholder="Search menu items..." style="flex: 1;" id="searchInput">
                            <select class="form-control" style="max-width: 200px;" id="filterAvailability">
                                <option value="all">All Items</option>
                                <option value="available">Available Only</option>
                                <option value="unavailable">Out of Stock</option>
                            </select>
                            <button class="btn btn-outline" onclick="loadMenuData()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Menu Items Table -->
                <div class="table-container mt-lg">
                    <table class="table">
                        <thead>
                            <tr>
                                <th style="width: 80px;">Image</th>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Dietary</th>
                                <th style="width: 200px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="menuItemsTable">
                            <tr>
                                <td colspan="7" class="text-center" style="padding: var(--spacing-xl);">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: var(--primary-color);"></i>
                                    <p class="text-muted mt-sm">Loading menu items...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div class="modal" id="addItemModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Add New Menu Item</h2>
                    <button class="modal-close" onclick="closeModal('addItemModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="menuItemForm">
                        <input type="hidden" id="itemId">

                        <div class="form-group">
                            <label class="form-label">Item Name *</label>
                            <input type="text" class="form-control" id="itemName" placeholder="Enter item name" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label class="form-label">Category</label>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <select class="form-control" id="itemCategory" style="flex: 1;">
                                        <option value="">Select category (optional)</option>
                                    </select>
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="openCategoryFromItem()" title="Add new category">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <small class="text-muted" id="categoryHelpText"></small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price *</label>
                                <input type="number" class="form-control" id="itemPrice" placeholder="0.00" step="0.01" min="0" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="itemDescription" placeholder="Enter item description" rows="3"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Type</label>
                                <select class="form-control" id="itemType">
                                    <option value="1">Vegetarian</option>
                                    <option value="0">Non-Vegetarian</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Prep Time (minutes)</label>
                                <input type="number" class="form-control" id="itemPrepTime" placeholder="15" min="1" value="15">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Image URL</label>
                            <input type="url" class="form-control" id="itemImage" placeholder="https://example.com/image.jpg">
                        </div>

                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="itemAvailable" checked>
                                <span>Available</span>
                            </label>
                        </div>

                        <div class="form-actions" style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                            <button type="submit" class="btn btn-primary" id="saveItemBtn">
                                <i class="fas fa-save"></i> Save Item
                            </button>
                            <button type="button" class="btn btn-outline" onclick="closeModal('addItemModal')">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" id="addCategoryModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add New Category</h2>
                    <button class="modal-close" onclick="closeModal('addCategoryModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <div class="form-group">
                            <label class="form-label">Category Name *</label>
                            <input type="text" class="form-control" id="categoryName" placeholder="e.g., Appetizers, Main Course, Desserts" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Display Order</label>
                            <input type="number" class="form-control" id="categoryOrder" placeholder="0" min="0" value="0">
                            <small class="text-muted">Lower numbers appear first</small>
                        </div>
                        <div class="form-actions" style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Add Category
                            </button>
                            <button type="button" class="btn btn-outline" onclick="closeModal('addCategoryModal')">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteConfirmModal">
        <div class="modal-dialog" style="max-width: 400px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Confirm Delete</h2>
                    <button class="modal-close" onclick="closeModal('deleteConfirmModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this menu item? This action cannot be undone.</p>
                    <div class="form-actions" style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                        <button class="btn btn-danger" id="confirmDeleteBtn">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button class="btn btn-outline" onclick="closeModal('deleteConfirmModal')">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../js/main.js"></script>
    <script>
        const token = localStorage.getItem('restaurantAuthToken');
        const user = JSON.parse(localStorage.getItem('restaurantUser') || '{}');

        if (!token || !user.user_id) {
            alert('Please login first');
            window.location.href = 'login.html';
        }

        const API_URL = 'http://localhost:5000/api';
        const getHeaders = () => ({
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        });

        let categories = [];
        let menuItems = [];
        let currentEditItemId = null;
        let itemToDelete = null;
        let returnToItemModal = false;

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üçΩÔ∏è Menu Management page loaded');
            await loadMenuData();
        });

        async function loadMenuData() {
            try {
                showLoading();
                console.log('üì• Loading menu data...');

                const [categoriesResponse, itemsResponse] = await Promise.all([
                    fetch(`${API_URL}/restaurant/menu/categories`, { headers: getHeaders() }),
                    fetch(`${API_URL}/restaurant/menu/items`, { headers: getHeaders() })
                ]);

                const categoriesResult = await categoriesResponse.json();
                const itemsResult = await itemsResponse.json();

                if (categoriesResponse.ok && categoriesResult.success) {
                    categories = categoriesResult.categories || [];
                    console.log('‚úÖ Categories loaded:', categories.length);
                    renderCategoryTabs();
                    populateCategoryDropdown();
                }

                if (itemsResponse.ok && itemsResult.success) {
                    menuItems = itemsResult.items || [];
                    console.log('‚úÖ Menu items loaded:', menuItems.length);
                    renderMenuItems();
                    updateStats();
                }

            } catch (error) {
                console.error('‚ùå Error loading menu data:', error);
                showAlert('Failed to load menu data: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        function renderCategoryTabs() {
            const tabsContainer = document.getElementById('categoryTabs');
            let tabsHTML = '<div class="nav-pill active" data-category="all" onclick="filterByCategory(\'all\')">All Items</div>';

            categories.forEach(cat => {
                tabsHTML += `<div class="nav-pill" data-category="${cat.category_id}" onclick="filterByCategory('${cat.category_id}')">${cat.name}</div>`;
            });

            tabsContainer.innerHTML = tabsHTML;
        }

        function populateCategoryDropdown() {
            const dropdown = document.getElementById('itemCategory');
            const helpText = document.getElementById('categoryHelpText');

            if (categories.length === 0) {
                dropdown.innerHTML = '<option value="">No categories - Click + to add one</option>';
                helpText.textContent = 'Add categories to organize your menu';
                helpText.style.color = '#ffc107';
            } else {
                dropdown.innerHTML = '<option value="">Uncategorized (Optional)</option>';
                categories.forEach(cat => {
                    dropdown.innerHTML += `<option value="${cat.category_id}">${cat.name}</option>`;
                });
                helpText.textContent = 'Optional - helps organize your menu';
                helpText.style.color = '';
            }
        }

        function renderMenuItems(itemsToRender = menuItems) {
            const tbody = document.getElementById('menuItemsTable');

            if (itemsToRender.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center" style="padding: var(--spacing-xl);">
                            <i class="fas fa-inbox" style="font-size: 48px; color: var(--text-muted); margin-bottom: var(--spacing-md);"></i>
                            <p class="text-muted">No menu items found. Add your first item!</p>
                            <button class="btn btn-primary mt-md" onclick="openAddItemModal()">
                                <i class="fas fa-plus"></i> Add Menu Item
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = itemsToRender.map(item => `
                <tr data-category="${item.category_id || 'uncategorized'}" data-item-id="${item.item_id}">
                    <td>
                        <img src="${item.image_url || 'https://via.placeholder.com/60?text=Food'}" 
                             alt="${item.name}" 
                             style="width: 60px; height: 60px; border-radius: var(--radius-md); object-fit: cover;"
                             onerror="this.src='https://via.placeholder.com/60?text=No+Image'">
                    </td>
                    <td>
                        <div>
                            <p class="fw-semibold" style="margin: 0;">${item.name}</p>
                            <p class="text-muted" style="font-size: var(--font-size-sm); margin: 0;">
                                ${item.description || 'No description'}
                            </p>
                        </div>
                    </td>
                    <td>${item.category_name || 'Uncategorized'}</td>
                    <td class="fw-semibold">$${parseFloat(item.price).toFixed(2)}</td>
                    <td>
                        <label class="d-flex align-center gap-xs" style="cursor: pointer;">
                            <input type="checkbox" ${item.is_available ? 'checked' : ''} 
                                   onchange="toggleAvailability(${item.item_id}, this.checked)">
                            <span class="badge ${item.is_available ? 'badge-success' : 'badge-warning'}">
                                ${item.is_available ? 'Available' : 'Out of Stock'}
                            </span>
                        </label>
                    </td>
                    <td>
                        <span class="badge ${item.is_vegetarian ? 'badge-success' : 'badge-danger'}">
                                                       ${item.is_vegetarian ? 'Veg' : 'Non-Veg'}
                        </span>
                    </td>
                    <td>
                        <div class="table-actions">
                            <button class="action-btn action-btn-edit" onclick="editItem(${item.item_id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn action-btn-delete" onclick="confirmDelete(${item.item_id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateStats() {
            const totalItems = menuItems.length;
            const availableItems = menuItems.filter(item => item.is_available).length;
            const unavailableItems = totalItems - availableItems;
            const totalCategories = categories.length;

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('availableItems').textContent = availableItems;
            document.getElementById('unavailableItems').textContent = unavailableItems;
            document.getElementById('totalCategories').textContent = totalCategories;
        }

        function filterByCategory(categoryId) {
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.classList.remove('active');
                if (pill.dataset.category === String(categoryId)) {
                    pill.classList.add('active');
                }
            });

            let filteredItems = menuItems;
            if (categoryId !== 'all') {
                filteredItems = menuItems.filter(item => String(item.category_id) === String(categoryId));
            }

            renderMenuItems(filteredItems);
        }

        document.getElementById('searchInput').addEventListener('keyup', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredItems = menuItems.filter(item => {
                return item.name.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                    (item.category_name && item.category_name.toLowerCase().includes(searchTerm));
            });
            renderMenuItems(filteredItems);
        });

        document.getElementById('filterAvailability').addEventListener('change', (e) => {
            const filter = e.target.value;
            let filteredItems = menuItems;

            if (filter === 'available') {
                filteredItems = menuItems.filter(item => item.is_available);
            } else if (filter === 'unavailable') {
                filteredItems = menuItems.filter(item => !item.is_available);
            }

            renderMenuItems(filteredItems);
        });

        async function toggleAvailability(itemId, isAvailable) {
            try {
                const response = await fetch(`${API_URL}/restaurant/menu/items/${itemId}`, {
                    method: 'PUT',
                    headers: getHeaders(),
                    body: JSON.stringify({ is_available: isAvailable })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showAlert(`Item ${isAvailable ? 'marked as available' : 'marked as out of stock'}`, 'success');
                    const item = menuItems.find(i => i.item_id === itemId);
                    if (item) {
                        item.is_available = isAvailable;
                    }
                    updateStats();
                } else {
                    throw new Error(result.message || 'Failed to update availability');
                }
            } catch (error) {
                console.error('‚ùå Error toggling availability:', error);
                showAlert('Failed to update availability: ' + error.message, 'error');
                await loadMenuData();
            }
        }

        function openAddItemModal() {
            currentEditItemId = null;
            document.getElementById('modalTitle').textContent = 'Add New Menu Item';
            document.getElementById('menuItemForm').reset();
            document.getElementById('itemId').value = '';
            document.getElementById('itemAvailable').checked = true;
            document.getElementById('saveItemBtn').innerHTML = '<i class="fas fa-save"></i> Save Item';
            openModal('addItemModal');
        }

        function openCategoryFromItem() {
            returnToItemModal = true;
            closeModal('addItemModal');
            openModal('addCategoryModal');
        }

        function editItem(itemId) {
            const item = menuItems.find(i => i.item_id === itemId);

            if (!item) {
                showAlert('Item not found', 'error');
                return;
            }

            currentEditItemId = itemId;
            document.getElementById('modalTitle').textContent = 'Edit Menu Item';
            document.getElementById('itemId').value = item.item_id;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemCategory').value = item.category_id || '';
            document.getElementById('itemPrice').value = item.price;
            document.getElementById('itemDescription').value = item.description || '';
            document.getElementById('itemType').value = item.is_vegetarian ? '1' : '0';
            document.getElementById('itemPrepTime').value = item.preparation_time || 15;
            document.getElementById('itemImage').value = item.image_url || '';
            document.getElementById('itemAvailable').checked = item.is_available;
            document.getElementById('saveItemBtn').innerHTML = '<i class="fas fa-save"></i> Update Item';

            openModal('addItemModal');
        }

        document.getElementById('menuItemForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const itemData = {
                name: document.getElementById('itemName').value.trim(),
                category_id: parseInt(document.getElementById('itemCategory').value) || null,
                price: parseFloat(document.getElementById('itemPrice').value),
                description: document.getElementById('itemDescription').value.trim(),
                is_vegetarian: parseInt(document.getElementById('itemType').value) === 1,
                preparation_time: parseInt(document.getElementById('itemPrepTime').value) || 15,
                image_url: document.getElementById('itemImage').value.trim() || null,
                is_available: document.getElementById('itemAvailable').checked
            };

            try {
                showLoading();

                let response;
                if (currentEditItemId) {
                    response = await fetch(`${API_URL}/restaurant/menu/items/${currentEditItemId}`, {
                        method: 'PUT',
                        headers: getHeaders(),
                        body: JSON.stringify(itemData)
                    });
                } else {
                    response = await fetch(`${API_URL}/restaurant/menu/items`, {
                        method: 'POST',
                        headers: getHeaders(),
                        body: JSON.stringify(itemData)
                    });
                }

                const result = await response.json();

                if (response.ok && result.success) {
                    showAlert(currentEditItemId ? 'Menu item updated successfully!' : 'Menu item added successfully!', 'success');
                    closeModal('addItemModal');
                    await loadMenuData();
                } else {
                    throw new Error(result.message || 'Failed to save menu item');
                }
            } catch (error) {
                console.error('‚ùå Error saving item:', error);
                showAlert('Failed to save menu item: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        });

        function confirmDelete(itemId) {
            itemToDelete = itemId;
            openModal('deleteConfirmModal');
        }

        document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
            if (!itemToDelete) return;

            try {
                showLoading();

                const response = await fetch(`${API_URL}/restaurant/menu/items/${itemToDelete}`, {
                    method: 'DELETE',
                    headers: getHeaders()
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showAlert('Menu item deleted successfully!', 'success');
                    closeModal('deleteConfirmModal');
                    await loadMenuData();
                } else {
                    throw new Error(result.message || 'Failed to delete item');
                }
            } catch (error) {
                console.error('‚ùå Error deleting item:', error);
                showAlert('Failed to delete item: ' + error.message, 'error');
            } finally {
                hideLoading();
                itemToDelete = null;
            }
        });

        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const categoryData = {
                name: document.getElementById('categoryName').value.trim(),
                display_order: parseInt(document.getElementById('categoryOrder').value) || 0
            };

            try {
                showLoading();

                const response = await fetch(`${API_URL}/restaurant/menu/categories`, {
                    method: 'POST',
                    headers: getHeaders(),
                    body: JSON.stringify(categoryData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showAlert('Category added successfully!', 'success');
                    closeModal('addCategoryModal');
                    document.getElementById('categoryForm').reset();
                    await loadMenuData();

                    if (returnToItemModal) {
                        returnToItemModal = false;
                        setTimeout(() => {
                            openModal('addItemModal');
                        }, 300);
                    }
                } else {
                    throw new Error(result.message || 'Failed to add category');
                }
            } catch (error) {
                console.error('‚ùå Error adding category:', error);
                showAlert('Failed to add category: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        });

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
                e.target.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                    modal.classList.remove('active');
                });
                document.body.style.overflow = 'auto';
            }
        });

        function showLoading() {
            let loader = document.getElementById('globalLoader');
            if (!loader) {
                loader = document.createElement('div');
                loader.id = 'globalLoader';
                loader.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 99999;';
                loader.innerHTML = '<div style="text-align: center; color: white;"><i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 16px;"></i><p style="font-size: 18px; font-weight: 500;">Loading...</p></div>';
                document.body.appendChild(loader);
            }
            loader.style.display = 'flex';
        }

        function hideLoading() {
            const loader = document.getElementById('globalLoader');
            if (loader) {
                loader.style.display = 'none';
            }
        }

        function showAlert(message, type = 'info') {
            let alertBox = document.getElementById('globalAlertBox');
            if (!alertBox) {
                alertBox = document.createElement('div');
                alertBox.id = 'globalAlertBox';
                document.body.appendChild(alertBox);
            }

            const colors = {
                'success': '#28a745',
                'error': '#dc3545',
                'danger': '#dc3545',
                'warning': '#ffc107',
                'info': '#17a2b8'
            };

            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'danger': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle'
            };

            alertBox.style.cssText = `position: fixed; top: 20px; right: 20px; background: ${colors[type] || colors.info}; color: white; padding: 16px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); z-index: 100000; font-weight: 500; min-width: 300px; max-width: 500px; display: flex; align-items: center; gap: 12px;`;
            alertBox.innerHTML = `<i class="fas ${icons[type] || icons.info}" style="font-size: 20px;"></i><span>${message}</span>`;

            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 3000);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('restaurantAuthToken');
                localStorage.removeItem('restaurantUser');
                localStorage.removeItem('restaurantData');
                window.location.href = 'login.html';
            }
        }

        document.getElementById('navbarToggle')?.addEventListener('click', () => {
            const menu = document.getElementById('navbarMenu');
            menu.classList.toggle('active');
        });

        console.log('‚úÖ Menu Management script loaded');
    </script>
</body>
</html>